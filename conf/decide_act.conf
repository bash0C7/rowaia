# Decide & Act Configuration

# Read processed contexts
<source>
  @type context
  path /tmp/fluentd/context
  tag decision
  run_interval 1800s  # 30 minutes
</source>

# Use LLM to make decisions
<filter decision>
  @type llm_generate
  
  # LLM settings
  model_name hf.co/elyza/Llama-3-ELYZA-JP-8B-GGUF:latest
  api_url http://localhost:11434/api
  
  # Prompt template for triage
  prompt_template |
    Below is information from various sources that needs to be triaged.
    
    <%= record["message"] %>
    
    Please categorize the priority as:
    1:red - Critical and requires immediate attention
    2:yellow - Important but not time-sensitive
    3:green - Normal priority, handle as scheduled
    4:black - Low priority or informational only
    
    Explain your reasoning for this categorization and provide specific next actions.
</filter>

# Send notification with results
<match decision>
  @type sstp
  
  # SSTP server settings
  sstp_server 127.0.0.1
  sstp_port 9801
  request_method NOTIFY
  request_version SSTP/1.1
  sender Rowaia
  
  # Notification template
  script_template \h\s[8]<%= record["llm_output"] %> \uHow would you like to proceed?\e
  
  <buffer>
    @type memory
    flush_mode immediate
  </buffer>
</match>